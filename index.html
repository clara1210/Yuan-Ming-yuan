<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>圆明园构件3D展示</title>
    <style>
        body { margin: 0; overflow: hidden; background: #fff !important; }
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000;
            font-size: 20px;
            z-index: 100;
        }
        #model-desc {
            position: fixed;
            bottom: 40px;
            left: 20px;
            right: 20px;
            z-index: 9;
            background: transparent;
            color: #000;
            font-size: 17px;
            line-height: 1.6;
            text-align: left;
            padding: 0;
            font-family: "Microsoft YaHei", sans-serif;
            margin: 0;
            letter-spacing: 0.5px;
        }
    </style>
    <!-- 直接引入Three.js（无CDN，本地解析） -->
    <script src="https://cdn.bootcdn.net/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/three.js/0.160.0/examples/js/loaders/GLTFLoader.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/three.js/0.160.0/examples/js/controls/OrbitControls.min.js"></script>
</head>
<body>
    <div class="loading">加载中...</div>
    <div id="model-desc">
        它不只是一件文物，更是一座‘百年水力钟’！马首作为海晏堂十二生肖水力钟的核心，专门对应午时（11:00-13:00）喷水，中西合璧的水利与计时智慧，在它身上体现得淋漓尽致。
    </div>

    <script>
        // 全局变量（不用module模式，避免解析错误）
        let scene, camera, renderer, model;
        const loadingText = document.querySelector('.loading');

        // 初始化场景（简化逻辑，避免加载冲突）
        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0xffffff);
            document.body.appendChild(renderer.domElement);

            // 光照（增强显示）
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.9);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.6);
            dirLight.position.set(3, 5, 4);
            scene.add(ambientLight, dirLight);

            // 控制器
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.minDistance = 2;
            controls.maxDistance = 8;
            controls.touches = { ONE: THREE.TOUCH.ROTATE, TWO: THREE.TOUCH.DOLLY_PAN };

            // 窗口自适应
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            // 加载模型
            loadModel();
        }

        // 模型加载（固定路径，增加详细日志）
        function loadModel() {
            const loader = new THREE.GLTFLoader();
            // 直接写死模型文件名（根据你仓库的实际文件名修改，二选一）
            const MODEL_URL = './3d model.glb'; // 带空格（优先试这个）
            // const MODEL_URL = './3dmodel.glb'; // 无空格（如果上面的不行，注释上面的，打开这个）

            // 超时处理（10秒）
            const timeout = setTimeout(() => {
                loadingText.innerText = '加载超时，检查模型路径';
                console.error('模型加载超时，可能路径错误');
            }, 10000);

            loader.load(
                MODEL_URL,
                (gltf) => {
                    clearTimeout(timeout);
                    model = gltf.scene;
                    model.scale.set(3.5, 3.5, 3.5);
                    model.position.set(0, -0.5, 0);
                    model.rotation.y = -Math.PI / 4;
                    scene.add(model);
                    loadingText.style.display = 'none';
                    console.log('模型加载成功！');
                },
                (xhr) => {
                    const progress = Math.floor((xhr.loaded / xhr.total) * 100);
                    loadingText.innerText = `加载中...${progress}%`;
                },
                (error) => {
                    clearTimeout(timeout);
                    loadingText.innerText = '加载失败，路径错误';
                    console.error('模型加载失败：', error);
                    console.error('当前尝试的模型路径：', MODEL_URL);
                }
            );
        }

        // 启动
        window.onload = init;

        // 动画循环
        function animate() {
            requestAnimationFrame(animate);
            if (window.controls) controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
