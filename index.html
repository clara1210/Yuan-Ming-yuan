<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>圆明园沉浸式数字展厅</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#000;font-family:Arial,sans-serif;}
.container{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:20px;}
.model-container{
width:100%;max-width:1000px;height:75vh;border-radius:15px;
overflow:hidden;position:relative;margin-bottom:20px;
box-shadow:0 30px 80px rgba(0,0,0,0.6);}
#modelCanvas{width:100%;height:100%;display:block;}
.loading{
position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
font-size:18px;color:#fff;}
.introduction{
width:100%;max-width:1000px;padding:30px;
text-align:center;font-size:16px;font-weight:bold;
background:rgba(255,255,255,0.95);border-radius:15px;
line-height:1.7;white-space:pre-line;
opacity:0;transition:opacity 0.8s ease;}
.introduction.show{opacity:1;}
.controls,.part-buttons{margin-top:20px;display:flex;gap:10px;justify-content:center;}
.part-btn{background:#b8860b;border:none;color:#fff;font-weight:bold;padding:8px 16px;border-radius:5px;cursor:pointer;}
.part-btn:hover{background:#d4af37;}
</style>
</head>

<body>
<div class="container">
<div class="model-container">
<div class="loading" id="loading">沉浸式加载中...</div>
<canvas id="modelCanvas"></canvas>
</div>

<div class="introduction" id="introText"></div>

<div class="part-buttons">
<button class="part-btn" onclick="triggerWater()">午时喷水演示</button>
<button class="part-btn" onclick="showIntroduction('mane')">鬓毛</button>
<button class="part-btn" onclick="showIntroduction('ear')">耳朵</button>
<button class="part-btn" onclick="showIntroduction('material')">材质</button>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/RGBELoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>

<script>
let scene,camera,renderer,controls,model;
let autoRotate=true;
let waterParticles;

function init(){

scene=new THREE.Scene();

/* HDR环境光 */
new THREE.RGBELoader()
.load('https://threejs.org/examples/textures/equirectangular/royal_esplanade_1k.hdr',
function(texture){
texture.mapping=THREE.EquirectangularReflectionMapping;
scene.environment=texture;
});

/* 背景 */
new THREE.TextureLoader().load('test1.jpg',t=>scene.background=t);

/* 相机 */
camera=new THREE.PerspectiveCamera(60,1,0.1,1000);
camera.position.set(0,1,8);

/* 渲染器 */
const container=document.querySelector('.model-container');
renderer=new THREE.WebGLRenderer({canvas:modelCanvas,antialias:true});
renderer.shadowMap.enabled=true;
renderer.physicallyCorrectLights=true;
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(container.clientWidth,container.clientHeight);

/* 灯光 */
scene.add(new THREE.AmbientLight(0xffffff,0.4));
const spot=new THREE.SpotLight(0xffffff,1.5);
spot.position.set(5,15,5);
spot.castShadow=true;
scene.add(spot);

/* 地面 */
const ground=new THREE.Mesh(
new THREE.PlaneGeometry(30,30),
new THREE.ShadowMaterial({opacity:0.3})
);
ground.rotation.x=-Math.PI/2;
ground.position.y=-1.5;
ground.receiveShadow=true;
scene.add(ground);

/* 控制器 */
controls=new THREE.OrbitControls(camera,renderer.domElement);
controls.enableDamping=true;
controls.addEventListener('start',()=>autoRotate=false);
controls.addEventListener('end',()=>autoRotate=true);

/* 模型 */
new THREE.GLTFLoader().load('model.glb',gltf=>{
model=gltf.scene;

model.traverse(obj=>{
if(obj.isMesh){
obj.castShadow=true;
/* 金属增强 */
obj.material.metalness=0.9;
obj.material.roughness=0.3;
}
});

scene.add(model);

const box=new THREE.Box3().setFromObject(model);
const center=box.getCenter(new THREE.Vector3());
model.position.sub(center);

startIntroCameraMove();

document.getElementById('loading').style.display='none';
});

/* resize */
window.addEventListener('resize',()=>{
camera.aspect=container.clientWidth/container.clientHeight;
camera.updateProjectionMatrix();
renderer.setSize(container.clientWidth,container.clientHeight);
});
}

/* 开场运镜 */
function startIntroCameraMove(){
let t=0;
function animateIntro(){
if(t<1){
t+=0.01;
camera.position.z=8-3*t;
requestAnimationFrame(animateIntro);
}
}
animateIntro();
}

/* 喷水粒子 */
function triggerWater(){
if(waterParticles) scene.remove(waterParticles);

const geometry=new THREE.BufferGeometry();
const count=200;
const positions=new Float32Array(count*3);

for(let i=0;i<count;i++){
positions[i*3]=0;
positions[i*3+1]=0;
positions[i*3+2]=0;
}

geometry.setAttribute('position',new THREE.BufferAttribute(positions,3));
const material=new THREE.PointsMaterial({color:0x66ccff,size:0.1});
waterParticles=new THREE.Points(geometry,material);
waterParticles.position.set(0,0.5,0);
scene.add(waterParticles);

let frame=0;
function animateWater(){
frame++;
const pos=waterParticles.geometry.attributes.position.array;
for(let i=0;i<count;i++){
pos[i*3]+= (Math.random()-0.5)*0.02;
pos[i*3+1]+=0.05;
}
waterParticles.geometry.attributes.position.needsUpdate=true;
if(frame<60) requestAnimationFrame(animateWater);
}
animateWater();
}

/* 文字保留 */
function showIntroduction(part){
const intro=document.getElementById("introText");
intro.classList.remove("show");

let text=`它不只是一件文物，更是一座“百年水力钟”！马首作为海晏堂十二生肖水力钟的核心，专门对应午时（11:00-13:00）喷水，中西合璧的水利与计时智慧，在它身上体现得淋漓尽致。
It is not just a cultural relic, but a century-old water clock!
As the centerpiece of the Twelve Chinese Zodiac Water Clock at the Haiyan Hall, the Horse Head spouts water specifically at the Wu hour (11:00–13:00).
The wisdom of water conservancy and timekeeping, a perfect fusion of Chinese and Western ingenuity, is vividly embodied in it.
`;

if(part==='mane'){
text=`这组灵动的卷曲鬃毛，竟出自郎世宁之手！它将西洋雕塑的写实细腻，与中国青铜工艺的厚重典雅完美融合，每一缕纹路都藏着清代宫廷造办处的巅峰技艺，历经百年依旧灵动鲜活。
These lively, curling manes are actually the work of Giuseppe Castiglione! They perfectly blend the realistic delicacy of Western sculpture with the solemn elegance of Chinese bronze craftsmanship. 
Every strand and pattern bears the supreme skill of the Qing court workshops, remaining vivid and vibrant even after a hundred years.
`;
}

if(part==='ear'){
text=`仔细看！这处残缺的右耳，藏着一段刻骨铭心的历史——1860年英法联军劫掠圆明园时，它被暴力损毁，成为文物百年流离的“无声见证者”。今天，就让我们用数字技术，为它补上这道跨越百年的“伤痕”。
Look closely! This damaged right ear holds a deeply unforgettable history.
In 1860, during the looting of the Old Summer Palace by Anglo-French forces, it was violently destroyed, becoming a silent witness to the relic’s century of displacement.
Today, let us use digital technology to mend this century-old scar.
`;
}

if(part==='material'){
text=`看似朴素的马首，藏着不简单的材质密码——它由98%高纯度红铜打造，搭配微量铅、铁、锌，与乾隆内务府档案记载的配方分毫不差，也正因如此，它才能历经百年风雨，依旧完好留存。
The seemingly simple Horse Head hides an extraordinary material secret.
Forged from 98% high-purity copper, with trace amounts of lead, iron, and zinc, its composition matches exactly the formula recorded in the archives of the Qianlong Imperial Household Department.
This is precisely why it has survived centuries of wind and rain and remained intact to this day.
`;
}

setTimeout(()=>{
intro.textContent=text;
intro.classList.add("show");
},200);
}

function animate(){
requestAnimationFrame(animate);
if(model && autoRotate) model.rotation.y+=0.002;
controls.update();
renderer.render(scene,camera);
}

init();
animate();
showIntroduction();
</script>

</body>
</html>
