<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>圆明园构件3D展示</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
    font-family: Arial, sans-serif;
    background:#f0f0f0;
}
.container{
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px;
}
.model-container{
    width:100%;
    max-width:900px;
    height:75vh;
    border-radius:20px;
    overflow:hidden;
    position:relative;
    margin-bottom:20px;
    box-shadow:0 25px 50px rgba(0,0,0,0.15);
}
#modelCanvas{
    width:100%;
    height:100%;
    display:block;
}
.loading{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    font-size:18px;
    color:#666;
    z-index:10;
}
.introduction{
    width:100%;
    max-width:900px;
    padding:30px;
    text-align:center;
    font-size:16px;
    font-weight:bold;
    background:rgba(255,255,255,0.95);
    border-radius:15px;
    line-height:1.7;
    white-space:pre-line;
    opacity:0;
    transition:opacity 0.6s ease;
    box-shadow:0 15px 30px rgba(0,0,0,0.08);
}
.introduction.show{opacity:1;}

.controls,.part-buttons,.model-switch{
    margin-top:20px;
    display:flex;
    gap:10px;
    justify-content:center;
}

.control-btn,.part-btn,.switch-btn{
    padding:8px 16px;
    border-radius:6px;
    cursor:pointer;
    border:none;
}

.control-btn{
    background:#ffffff;
    box-shadow:0 4px 10px rgba(0,0,0,0.08);
}

.part-btn{
    background:#b8860b;
    color:#fff;
    font-weight:bold;
}
.part-btn:hover{background:#d4af37;}

.switch-btn{
    background:#444;
    color:#fff;
    transition:all 0.3s;
}
.switch-btn.active{
    background:#b8860b;
}
.switch-btn:hover{
    background:#222;
}
</style>
</head>

<body>
<div class="container">

<div class="model-container">
<div class="loading" id="loading">加载中...</div>
<canvas id="modelCanvas"></canvas>
</div>

<div class="model-switch">
<button id="afterBtn" class="switch-btn active" onclick="switchModel('model.glb','after')">修复后的马首</button>
<button id="beforeBtn" class="switch-btn" onclick="switchModel('horse model.glb','before')">修复前的马首</button>
</div>

<div class="introduction" id="introText"></div>

<div class="controls">
<button class="control-btn" onclick="resetCamera()">重置视角</button>
<button class="control-btn" onclick="zoomIn()">放大</button>
<button class="control-btn" onclick="zoomOut()">缩小</button>
</div>

<div class="part-buttons">
<button class="part-btn" onclick="showIntroduction('mane')">鬓毛</button>
<button class="part-btn" onclick="showIntroduction('ear')">耳朵</button>
<button class="part-btn" onclick="showIntroduction('material')">材质</button>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>

<script>
let scene,camera,renderer,controls,model;
let loader;
let autoRotate=true;
let currentState="after";

function createGradientBackground(){
    const canvas=document.createElement('canvas');
    canvas.width=2;
    canvas.height=512;
    const ctx=canvas.getContext('2d');
    const gradient=ctx.createLinearGradient(0,0,0,512);
    gradient.addColorStop(0,'#f7f7f7');
    gradient.addColorStop(1,'#e6e6e6');
    ctx.fillStyle=gradient;
    ctx.fillRect(0,0,2,512);
    return new THREE.CanvasTexture(canvas);
}

function init(){

scene=new THREE.Scene();
scene.background=createGradientBackground();

camera=new THREE.PerspectiveCamera(60,1,0.1,1000);
camera.position.set(0,1,6);

const container=document.querySelector('.model-container');
renderer=new THREE.WebGLRenderer({
    canvas:document.getElementById('modelCanvas'),
    antialias:true
});
renderer.shadowMap.enabled=true;
renderer.shadowMap.type=THREE.PCFSoftShadowMap;
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(container.clientWidth,container.clientHeight);

scene.add(new THREE.AmbientLight(0xffffff,0.5));

const light=new THREE.SpotLight(0xffffff,1.2);
light.position.set(5,10,5);
light.castShadow=true;
scene.add(light);

const ground=new THREE.Mesh(
    new THREE.PlaneGeometry(20,20),
    new THREE.ShadowMaterial({opacity:0.3})
);
ground.rotation.x=-Math.PI/2;
ground.position.y=-1.5;
ground.receiveShadow=true;
scene.add(ground);

controls=new THREE.OrbitControls(camera,renderer.domElement);
controls.enableDamping=true;
controls.enablePan=false;
controls.addEventListener('start',()=>autoRotate=false);
controls.addEventListener('end',()=>autoRotate=true);

loader=new THREE.GLTFLoader();
loadModel('model.glb');

window.addEventListener('resize',onWindowResize);
}

function fadeOut(object,callback){
let opacity=1;
const interval=setInterval(()=>{
opacity-=0.05;
object.traverse(o=>{
if(o.isMesh){
o.material.transparent=true;
o.material.opacity=opacity;
}
});
if(opacity<=0){
clearInterval(interval);
callback();
}
},30);
}

function fadeIn(object){
let opacity=0;
object.traverse(o=>{
if(o.isMesh){
o.material.transparent=true;
o.material.opacity=0;
}
});
const interval=setInterval(()=>{
opacity+=0.05;
object.traverse(o=>{
if(o.isMesh){
o.material.opacity=opacity;
}
});
if(opacity>=1){
clearInterval(interval);
}
},30);
}

function loadModel(path){
document.getElementById('loading').style.display='block';

loader.load(path,function(gltf){
model=gltf.scene;
model.traverse(o=>{if(o.isMesh){o.castShadow=true;}});
scene.add(model);

const box=new THREE.Box3().setFromObject(model);
const center=box.getCenter(new THREE.Vector3());
model.position.sub(center);

fadeIn(model);

document.getElementById('loading').style.display='none';
});
}

function switchModel(path,state){

if(currentState===state)return;

document.getElementById('afterBtn').classList.remove('active');
document.getElementById('beforeBtn').classList.remove('active');

if(state==="after"){
document.getElementById('afterBtn').classList.add('active');
}else{
document.getElementById('beforeBtn').classList.add('active');
}

currentState=state;

fadeOut(model,()=>{
scene.remove(model);
loadModel(path);
});

if(state==="before"){
showCustomIntro("这是1860年劫掠后残损状态的马首模型，保留历史痕迹。");
}else{
showIntroduction();
}
}

function showCustomIntro(text){
const intro=document.getElementById("introText");
intro.classList.remove("show");
setTimeout(()=>{
intro.textContent=text;
intro.classList.add("show");
},200);
}

function animate(){
requestAnimationFrame(animate);
if(model && autoRotate){
model.rotation.y+=0.003;
}
controls.update();
renderer.render(scene,camera);
}

function onWindowResize(){
const container=document.querySelector('.model-container');
camera.aspect=container.clientWidth/container.clientHeight;
camera.updateProjectionMatrix();
renderer.setSize(container.clientWidth,container.clientHeight);
}

function resetCamera(){
camera.position.set(0,1,6);
controls.target.set(0,0,0);
controls.update();
}
function zoomIn(){camera.position.z*=0.85;}
function zoomOut(){camera.position.z*=1.15;}

init();
animate();
</script>

</body>
</html>
