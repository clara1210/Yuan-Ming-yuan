<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>圆明园沉浸式3D展示</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
    font-family:Arial, sans-serif;
    background:#000;
}
.container{
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px;
}
.model-container{
    width:100%;
    max-width:900px;
    height:75vh;
    border-radius:15px;
    overflow:hidden;
    position:relative;
    margin-bottom:20px;
    box-shadow:0 20px 60px rgba(0,0,0,0.4);
}
#modelCanvas{
    width:100%;
    height:100%;
    display:block;
}
.loading{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    font-size:18px;
    color:#fff;
    z-index:10;
}
.introduction{
    width:100%;
    max-width:900px;
    padding:30px;
    text-align:center;
    font-size:17px;
    font-weight:bold;
    background:rgba(255,255,255,0.9);
    border-radius:15px;
    line-height:1.7;
    white-space:pre-line;
    opacity:0;
    transition:opacity 0.6s ease;
}
.introduction.show{
    opacity:1;
}
.controls,.part-buttons{
    margin-top:20px;
    display:flex;
    gap:10px;
    justify-content:center;
}
.control-btn,.part-btn{
    padding:10px 18px;
    border-radius:6px;
    cursor:pointer;
}
.control-btn{
    border:none;
    background:#ffffff;
}
.part-btn{
    background:#b8860b;
    border:none;
    color:#fff;
    font-weight:bold;
}
.part-btn:hover{
    background:#d4af37;
}
</style>
</head>

<body>
<div class="container">

<div class="model-container">
<div class="loading" id="loading">加载中...</div>
<canvas id="modelCanvas"></canvas>
</div>

<div class="introduction" id="introText"></div>

<div class="controls">
<button class="control-btn" onclick="resetCamera()">重置视角</button>
<button class="control-btn" onclick="zoomIn()">放大</button>
<button class="control-btn" onclick="zoomOut()">缩小</button>
</div>

<div class="part-buttons">
<button class="part-btn" onclick="showIntroduction('mane')">鬓毛</button>
<button class="part-btn" onclick="showIntroduction('ear')">耳朵</button>
<button class="part-btn" onclick="showIntroduction('material')">材质</button>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>

<script>
let scene,camera,renderer,controls,model;
let raycaster=new THREE.Raycaster();
let mouse=new THREE.Vector2();

function init(){

scene=new THREE.Scene();

/* 背景 */
const loader=new THREE.TextureLoader();
loader.load('test1.jpg',function(texture){
    texture.encoding=THREE.sRGBEncoding;
    scene.background=texture;
});

/* 相机 */
camera=new THREE.PerspectiveCamera(60,1,0.1,1000);
camera.position.set(0,1,5);

/* 渲染器 */
const container=document.querySelector('.model-container');
renderer=new THREE.WebGLRenderer({
    canvas:document.getElementById('modelCanvas'),
    antialias:true
});
renderer.shadowMap.enabled=true;
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(container.clientWidth,container.clientHeight);

/* 灯光 */
scene.add(new THREE.AmbientLight(0xffffff,0.6));

const spotLight=new THREE.SpotLight(0xffffff,1);
spotLight.position.set(5,10,5);
spotLight.castShadow=true;
scene.add(spotLight);

/* 地面 */
const ground=new THREE.Mesh(
    new THREE.PlaneGeometry(20,20),
    new THREE.ShadowMaterial({opacity:0.3})
);
ground.rotation.x=-Math.PI/2;
ground.position.y=-1.5;
ground.receiveShadow=true;
scene.add(ground);

/* 控制器 */
controls=new THREE.OrbitControls(camera,renderer.domElement);
controls.enableDamping=true;
controls.enablePan=false;

/* 加载模型 */
const gltfLoader=new THREE.GLTFLoader();
gltfLoader.load('model.glb',function(gltf){

model=gltf.scene;
model.traverse(obj=>{
    if(obj.isMesh){
        obj.castShadow=true;
    }
});
scene.add(model);

const box=new THREE.Box3().setFromObject(model);
const center=box.getCenter(new THREE.Vector3());
model.position.sub(center);

camera.position.z=6;
controls.target.set(0,0,0);
controls.update();

document.getElementById('loading').style.display='none';

});

window.addEventListener('resize',onWindowResize);
window.addEventListener('click',onMouseClick);
}

function onWindowResize(){
const container=document.querySelector('.model-container');
camera.aspect=container.clientWidth/container.clientHeight;
camera.updateProjectionMatrix();
renderer.setSize(container.clientWidth,container.clientHeight);
}

function animate(){
requestAnimationFrame(animate);
controls.update();
renderer.render(scene,camera);
}

function highlightModel(){
model.traverse(obj=>{
if(obj.isMesh){
obj.material.emissive=new THREE.Color(0x444400);
setTimeout(()=>{
obj.material.emissive=new THREE.Color(0x000000);
},300);
}
});
}

function onMouseClick(event){
if(!model)return;
highlightModel();
showIntroduction('mane');
}

function resetCamera(){
camera.position.set(0,1,6);
controls.target.set(0,0,0);
controls.update();
}
function zoomIn(){camera.position.z*=0.85;}
function zoomOut(){camera.position.z*=1.15;}

function showIntroduction(part){
const intro=document.getElementById("introText");
intro.classList.remove("show");

let text=`它不只是一件文物，更是一座“百年水力钟”！
中西水利与计时智慧的完美融合。`;

if(part==='mane'){
text=`灵动卷曲的鬃毛融合西洋写实与东方工艺。`;
}
if(part==='ear'){
text=`残缺的右耳见证1860年的历史风雨。`;
}
if(part==='material'){
text=`98%高纯度红铜铸造，百年不朽。`;
}

setTimeout(()=>{
intro.textContent=text;
intro.classList.add("show");
},200);
}

init();
animate();
showIntroduction();
</script>

</body>
</html>
