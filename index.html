<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åœ†æ˜å›­æ„ä»¶3Då±•ç¤º</title>
    <style>
        body { margin: 0; overflow: hidden; background: #fff !important; }
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000;
            font-size: 20px;
            z-index: 100;
            cursor: pointer; /* ç‚¹å‡»é‡è¯• */
        }
        /* åº•éƒ¨æ–‡å­—ï¼šå·¦å¯¹é½ã€å æ»¡å±å¹•ã€æ‰‹æœºæ¸…æ™°æ˜¾ç¤º */
        #model-desc {
            position: fixed;
            bottom: 40px;
            left: 20px;
            right: 20px;
            z-index: 9;
            background: transparent;
            color: #000;
            font-size: 17px;
            line-height: 1.6;
            text-align: left;
            padding: 0;
            font-family: "Microsoft YaHei", sans-serif;
            margin: 0;
            letter-spacing: 0.5px;
        }
        /* é¡¶éƒ¨å¼¹çª—ï¼šåŠé€æ˜èƒŒæ™¯ã€ä¸æŒ¡æ¨¡å‹ */
        .popup-desc {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 99;
            background: rgba(255, 255, 255, 0.95);
            color: #000;
            font-size: 16px;
            line-height: 1.5;
            padding: 18px 20px;
            border-radius: 12px;
            max-width: 85%;
            text-align: left;
            font-family: "Microsoft YaHei", sans-serif;
            box-shadow: 0 3px 18px rgba(0,0,0,0.15);
            display: none;
        }
        .popup-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 22px;
            color: #666;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
        }
        .popup-close:hover {
            color: #000;
        }
    </style>
    <!-- è¿˜åŸä½ ä¹‹å‰å¯ç”¨çš„ CDNï¼ŒåŒæ—¶å¤‡ç”¨å›½å†…èŠ‚ç‚¹ -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <!-- å¤‡ç”¨CDNï¼ˆè‹¥jsdelivrå¤±æ•ˆè‡ªåŠ¨åˆ‡æ¢ï¼‰ -->
    <script>
        window.addEventListener('error', (e) => {
            if (e.message.includes('Failed to fetch') && e.filename.includes('jsdelivr')) {
                console.warn('jsdelivr CDNå¤±æ•ˆï¼Œåˆ‡æ¢åˆ°å¤‡ç”¨CDN');
                // é‡æ–°å®šä¹‰importmap
                const importMap = document.createElement('script');
                importMap.type = 'importmap';
                importMap.textContent = JSON.stringify({
                    "imports": {
                        "three": "https://cdn.byteintl.com/three.js/0.160.0/three.module.js",
                        "three/addons/": "https://cdn.byteintl.com/three.js/0.160.0/examples/jsm/"
                    }
                });
                document.head.appendChild(importMap);
                // åˆ·æ–°é¡µé¢ç”Ÿæ•ˆ
                window.location.reload();
            }
        });
    </script>
</head>
<body>
    <div class="loading">åŠ è½½ä¸­...</div>
    <!-- åº•éƒ¨å·¦å¯¹é½è¯´æ˜æ–‡å­— -->
    <div id="model-desc">
        å®ƒä¸åªæ˜¯ä¸€ä»¶æ–‡ç‰©ï¼Œæ›´æ˜¯ä¸€åº§â€˜ç™¾å¹´æ°´åŠ›é’Ÿâ€™ï¼é©¬é¦–ä½œä¸ºæµ·æ™å ‚åäºŒç”Ÿè‚–æ°´åŠ›é’Ÿçš„æ ¸å¿ƒï¼Œä¸“é—¨å¯¹åº”åˆæ—¶ï¼ˆ11:00-13:00ï¼‰å–·æ°´ï¼Œä¸­è¥¿åˆç’§çš„æ°´åˆ©ä¸è®¡æ—¶æ™ºæ…§ï¼Œåœ¨å®ƒèº«ä¸Šä½“ç°å¾—æ·‹æ¼“å°½è‡´ã€‚
    </div>
    <!-- è€³æœµç‚¹å‡»å¼¹çª—ï¼ˆå·¦å³è€³å…±ç”¨ï¼‰ -->
    <div class="popup-desc" id="ear-popup">
        <button class="popup-close">&times;</button>
        ä»”ç»†çœ‹ï¼è¿™å¤„æ®‹ç¼ºçš„å³è€³ï¼Œè—ç€ä¸€æ®µåˆ»éª¨é“­å¿ƒçš„å†å²â€”â€”1860å¹´è‹±æ³•è”å†›åŠ«æ åœ†æ˜å›­æ—¶ï¼Œå®ƒè¢«æš´åŠ›æŸæ¯ï¼Œæˆä¸ºæ–‡ç‰©ç™¾å¹´æµç¦»çš„â€œæ— å£°è§è¯è€…â€ã€‚ä»Šå¤©ï¼Œå°±è®©æˆ‘ä»¬ç”¨æ•°å­—æŠ€æœ¯ï¼Œä¸ºå®ƒè¡¥ä¸Šè¿™é“è·¨è¶Šç™¾å¹´çš„â€œä¼¤ç—•â€ã€‚
    </div>
    <!-- é¬“æ¯›ç‚¹å‡»å¼¹çª— -->
    <div class="popup-desc" id="mane-popup">
        <button class="popup-close">&times;</button>
        è¿™ç»„çµåŠ¨çš„å·æ›²é¬ƒæ¯›ï¼Œç«Ÿå‡ºè‡ªéƒä¸–å®ä¹‹æ‰‹ï¼å®ƒå°†è¥¿æ´‹é›•å¡‘çš„å†™å®ç»†è…»ï¼Œä¸ä¸­å›½é’é“œå·¥è‰ºçš„åšé‡å…¸é›…å®Œç¾èåˆï¼Œæ¯ä¸€ç¼•çº¹è·¯éƒ½è—ç€æ¸…ä»£å®«å»·é€ åŠå¤„çš„å·…å³°æŠ€è‰ºï¼Œå†ç»ç™¾å¹´ä¾æ—§çµåŠ¨é²œæ´»ã€‚
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // å…¨å±€å˜é‡åˆå§‹åŒ–ï¼ˆå®Œå…¨æ²¿ç”¨ä½ ä¹‹å‰çš„é…ç½®ï¼‰
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0xffffff);
        document.body.appendChild(renderer.domElement);

        // å…‰ç…§é…ç½®ï¼ˆå®Œå…¨æ²¿ç”¨ä½ ä¹‹å‰çš„æˆåŠŸå‚æ•°ï¼‰
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(5, 5, 5);
        scene.add(ambientLight, directionalLight);

        // å¼¹çª—å…ƒç´ è·å–ä¸å…³é—­é€»è¾‘ï¼ˆä¸å˜ï¼‰
        const earPopup = document.getElementById('ear-popup');
        const manePopup = document.getElementById('mane-popup');
        const closeButtons = document.querySelectorAll('.popup-close');

        closeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                earPopup.style.display = 'none';
                manePopup.style.display = 'none';
            });
        });

        document.addEventListener('click', (e) => {
            if (e.target === document.body || e.target === renderer.domElement) {
                earPopup.style.display = 'none';
                manePopup.style.display = 'none';
            }
        });

        // æ¨¡å‹åŠ è½½æ ¸å¿ƒé€»è¾‘ï¼ˆå…³é”®ï¼šè¿˜åŸä½ ä¹‹å‰çš„è·¯å¾„ï¼Œæ–°å¢é”™è¯¯åé¦ˆå’Œé‡è¯•ï¼‰
        const loader = new GLTFLoader();
        const loadingText = document.querySelector('.loading');
        let model = null;
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        // ğŸ”¥ å®Œå…¨è¿˜åŸä½ ä¹‹å‰èƒ½åŠ è½½çš„è·¯å¾„ ğŸ”¥
        const modelPath = './3d%20model.glb';

        // åŠ è½½è¶…æ—¶å¤„ç†ï¼ˆ10ç§’æœªåŠ è½½æç¤ºï¼‰
        const timeoutTimer = setTimeout(() => {
            loadingText.innerText = 'åŠ è½½è¶…æ—¶ï¼Œç‚¹å‡»é‡è¯•';
        }, 10000);

        loader.load(
            modelPath,
            (gltf) => {
                clearTimeout(timeoutTimer); // æ¸…é™¤è¶…æ—¶
                model = gltf.scene;
                model.scale.set(3.5, 3.5, 3.5);
                model.position.set(0, -0.5, 0);
                model.rotation.y = -Math.PI / 4; // å‘å·¦è½¬45Â°ï¼ˆä½ ä¹‹å‰çš„æˆåŠŸè§’åº¦ï¼‰
                scene.add(model);
                loadingText.style.display = 'none';

                // æ ‡è®°æ‰€æœ‰Meshä¸ºå¯ç‚¹å‡»ï¼ˆä¸å˜ï¼‰
                model.traverse((child) => {
                    if (child.isMesh) {
                        child.userData.clickable = true;
                    }
                });
            },
            (xhr) => {
                // æ˜¾ç¤ºåŠ è½½è¿›åº¦ï¼ˆè®©ä½ çœ‹åˆ°åŠ è½½çŠ¶æ€ï¼‰
                const progress = (xhr.loaded / xhr.total * 100).toFixed(0);
                loadingText.innerText = `åŠ è½½ä¸­...${progress}%`;
            },
            (error) => {
                clearTimeout(timeoutTimer);
                console.error('æ¨¡å‹åŠ è½½å¤±è´¥åŸå› ï¼š', error);
                // æ ¹æ®é”™è¯¯ç±»å‹æç¤º
                if (error.message.includes('404')) {
                    loadingText.innerText = 'æ¨¡å‹æ–‡ä»¶æœªæ‰¾åˆ°ï¼ˆè·¯å¾„é”™è¯¯ï¼‰ï¼Œç‚¹å‡»é‡è¯•';
                } else if (error.message.includes('CORS')) {
                    loadingText.innerText = 'è·¨åŸŸé”™è¯¯ï¼ˆå°ç¨‹åºåŸŸåæœªé…ç½®ï¼‰ï¼Œç‚¹å‡»é‡è¯•';
                } else {
                    loadingText.innerText = 'åŠ è½½å¤±è´¥ï¼Œç‚¹å‡»é‡è¯•';
                }
                // ç‚¹å‡»é‡è¯•
                loadingText.addEventListener('click', () => window.location.reload());
            }
        );

        // ç›¸æœºä¸æ§åˆ¶å™¨é…ç½®ï¼ˆå®Œå…¨æ²¿ç”¨ä½ ä¹‹å‰çš„æˆåŠŸå‚æ•°ï¼‰
        camera.position.z = 5;
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.autoRotate = false;
        controls.enableDamping = true;
        controls.enableRotate = true;
        controls.enableZoom = true;
        controls.minDistance = 2;
        controls.maxDistance = 8;
        controls.touches = {
            ONE: THREE.TOUCH.ROTATE,
            TWO: THREE.TOUCH.DOLLY_PAN
        };
        controls.reset();

        // ç‚¹å‡»/è§¦æ‘¸äº‹ä»¶å¤„ç†ï¼ˆå®Œå…¨æ²¿ç”¨ä½ ä¹‹å‰çš„è¯†åˆ«é€»è¾‘ï¼‰
        function onPointerDown(e) {
            if (!model) return;

            // åæ ‡è½¬æ¢ï¼ˆå…¼å®¹æ‰‹æœºè§¦æ‘¸å’Œç”µè„‘é¼ æ ‡ï¼‰
            if (e.type === 'touchstart') {
                const touch = e.touches[0];
                mouse.x = (touch.clientX / window.innerWidth) * 2 - 1;
                mouse.y = - (touch.clientY / window.innerHeight) * 2 + 1;
            } else {
                mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
                mouse.y = - (e.clientY / window.innerHeight) * 2 + 1;
            }

            // å°„çº¿æ£€æµ‹ç‚¹å‡»éƒ¨ä½
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(model.children, true);

            if (intersects.length > 0) {
                const clickedObject = intersects[0].object;
                const worldPosition = new THREE.Vector3();
                clickedObject.getWorldPosition(worldPosition);

                // ç²¾å‡†è¯†åˆ«èŒƒå›´ï¼ˆä½ ä¹‹å‰çš„æˆåŠŸå‚æ•°ï¼‰
                const isLeftEar = worldPosition.x < -1.2 && worldPosition.y > 0.5 && worldPosition.z > -0.5;
                const isRightEar = worldPosition.x > 1.2 && worldPosition.y > 0.5 && worldPosition.z > -0.5;
                const isMane = worldPosition.x > -0.8 && worldPosition.x < 0.8 && worldPosition.y < 0.5 && worldPosition.y > -0.3;

                // å¼¹çª—è§¦å‘é€»è¾‘
                if (isLeftEar || isRightEar) {
                    earPopup.style.display = 'block';
                    manePopup.style.display = 'none';
                } else if (isMane) {
                    manePopup.style.display = 'block';
                    earPopup.style.display = 'none';
                } else {
                    earPopup.style.display = 'none';
                    manePopup.style.display = 'none';
                }
            }
        }

        // ç»‘å®šäº¤äº’äº‹ä»¶ï¼ˆä¸å˜ï¼‰
        window.addEventListener('click', onPointerDown);
        window.addEventListener('touchstart', onPointerDown);

        // çª—å£è‡ªé€‚åº”è°ƒæ•´ï¼ˆä¸å˜ï¼‰
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // åŠ¨ç”»å¾ªç¯ï¼ˆä¸å˜ï¼‰
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
