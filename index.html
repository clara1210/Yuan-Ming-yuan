<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>圆明园兽首 · 数字重生</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#000;color:#fff;font-family:Arial,Helvetica,sans-serif;overflow:hidden;}

#selectPage{
position:absolute;width:100%;height:100vh;
display:flex;flex-direction:column;
align-items:center;justify-content:center;
gap:40px;background:black;
}

.select-btn{
width:220px;height:220px;
border:none;border-radius:15px;
background-size:cover;background-position:center;
box-shadow:0 0 40px rgba(0,255,255,0.6);
cursor:pointer;
transition:0.4s;
}
.select-btn:hover{
transform:scale(1.1);
box-shadow:0 0 80px rgba(0,255,255,1);
}

#viewerPage{display:none;width:100%;height:100vh;position:absolute;}

#modelCanvas{width:100%;height:100%;display:block;}

#backBtn{
position:absolute;top:20px;left:20px;
padding:10px 20px;border:none;border-radius:6px;
background:#b8860b;color:white;font-weight:bold;
z-index:5;
}

#introText{
position:absolute;bottom:100px;left:50%;
transform:translateX(-50%);
width:80%;max-width:900px;
background:rgba(0,0,0,0.75);
padding:25px;border-radius:12px;
line-height:1.6;font-size:16px;
opacity:0;transition:1s;
}

#introText.show{opacity:1;}

.timeline{
position:absolute;
bottom:30px;
left:50%;
transform:translateX(-50%);
font-size:18px;
letter-spacing:4px;
opacity:0;
transition:1.5s;
color:#00ffff;
}

.timeline.show{opacity:1;}

.part-buttons{
position:absolute;
top:20px;
right:20px;
display:flex;
flex-direction:column;
gap:10px;
z-index:5;
}

.part-btn{
padding:8px 14px;
background:#111;
border:1px solid #00ffff;
color:#00ffff;
cursor:pointer;
transition:0.3s;
}
.part-btn:hover{
background:#00ffff;
color:black;
}

</style>
</head>
<body>

<div id="selectPage">
<button class="select-btn" onclick="startViewer('horse')" style="background-image:url('horsepicture.jpg')"></button>
<button class="select-btn" onclick="startViewer('tiger')" style="background-image:url('tigerpicture.jpg')"></button>
</div>

<div id="viewerPage">
<button id="backBtn" onclick="returnToSelect()">返回</button>
<canvas id="modelCanvas"></canvas>
<div id="introText"></div>
<div class="timeline" id="timeline">
1860  劫掠流失   ·   2007  马首回归   ·   2019  虎首回归   ·   数字时代 3D重建
</div>
<div class="part-buttons" id="partButtons"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>

<script>

let scene,camera,renderer,controls,model;
let currentModel='';
let modelScale=1;

/* 页面切换 */
function startViewer(type){
currentModel=type;
document.getElementById("selectPage").style.display="none";
document.getElementById("viewerPage").style.display="block";
init();
setupButtons();
animate();
showIntro();
}

function returnToSelect(){
location.reload();
}

/* 初始化 */
function init(){
scene=new THREE.Scene();
scene.background=new THREE.Color(0x000000);

const canvas=document.getElementById("modelCanvas");

camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,0.1,1000);
camera.position.set(0,2,6);

renderer=new THREE.WebGLRenderer({canvas:canvas,antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.physicallyCorrectLights=true;

controls=new THREE.OrbitControls(camera,renderer.domElement);
controls.enableDamping=true;

/* 灯光 */
const ambient=new THREE.AmbientLight(0x111111);
scene.add(ambient);

const spot=new THREE.SpotLight(0xffffff,4);
spot.position.set(5,12,8);
spot.angle=0.3;
scene.add(spot);

const rim=new THREE.DirectionalLight(0x00ffff,2);
rim.position.set(-5,5,-5);
scene.add(rim);

window.addEventListener("resize",()=>{
camera.aspect=window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});

loadNewModel();
}

/* 加载模型 */
function loadModel(url){
const loader=new THREE.GLTFLoader();

loader.load(url,function(gltf){

if(model) scene.remove(model);
model=gltf.scene;
scene.add(model);

/* 自动居中 */
const box=new THREE.Box3().setFromObject(model);
const size=box.getSize(new THREE.Vector3());
const center=box.getCenter(new THREE.Vector3());
model.position.sub(center);
const maxDim=Math.max(size.x,size.y,size.z);
const scale=3/maxDim;
model.scale.setScalar(scale*modelScale);

/* 能量重建动画 */
model.traverse(child=>{
if(child.isMesh){
child.material.transparent=true;
child.material.opacity=0;
child.material.emissive=new THREE.Color(0x00ffff);
child.material.emissiveIntensity=1.5;
}
});

let progress=0;
const build=setInterval(()=>{
progress+=0.04;
model.traverse(c=>{
if(c.isMesh){
c.material.opacity=progress;
c.material.emissiveIntensity=1.5-progress;
}
});
if(progress>=1) clearInterval(build);
},30);

document.getElementById("timeline").classList.add("show");
});
}

function loadOldModel(){
if(currentModel==='horse') loadModel("horse.glb");
else loadModel("tiger.glb");
}
function loadNewModel(){
if(currentModel==='horse') loadModel("horse model.glb");
else loadModel("tiger model.glb");
}

/* 悬浮旋转 */
function animate(){
requestAnimationFrame(animate);
if(model){
model.rotation.y+=0.004;
model.position.y=Math.sin(Date.now()*0.0015)*0.15;
}
controls.update();
renderer.render(scene,camera);
}

/* 扫描特效 */
function scanEffect(){
const geo=new THREE.RingGeometry(0.5,0.6,32);
const mat=new THREE.MeshBasicMaterial({color:0x00ffff,side:THREE.DoubleSide,transparent:true});
const ring=new THREE.Mesh(geo,mat);
ring.rotation.x=-Math.PI/2;
scene.add(ring);
let s=0.1;
const expand=setInterval(()=>{
s+=0.1;
ring.scale.set(s,s,s);
ring.material.opacity-=0.03;
if(ring.material.opacity<=0){
scene.remove(ring);
clearInterval(expand);
}
},30);
}

/* 文字介绍（完整保留） */
function showIntro(){
const intro=document.getElementById("introText");
let text="";
if(currentModel==='horse'){
text="它不只是一件文物，更是一座“百年水力钟”！马首作为海晏堂十二生肖水力钟的核心，专门对应午时（11:00-13:00）喷水，中西合璧的水利与计时智慧，在它身上体现得淋漓尽致。";
}else{
text="虎对应寅时（3:00—5:00），是黎明将至、万物苏醒之时。虎首每到寅时自动喷水，正午与十一兽首齐喷，是古人把生肖文化、计时文化、水利科技合为一体的绝妙设计。";
}
intro.innerText=text;
setTimeout(()=>intro.classList.add("show"),500);
}

/* 部件按钮 */
function setupButtons(){
const c=document.getElementById("partButtons");
if(currentModel==='horse'){
modelScale=1;
c.innerHTML=`
<button class="part-btn" onclick="scanEffect();loadOldModel();">修复前</button>
<button class="part-btn" onclick="scanEffect();loadNewModel();">修复后</button>
`;
}else{
modelScale=2;
c.innerHTML=`
<button class="part-btn" onclick="scanEffect();loadOldModel();">修复前</button>
<button class="part-btn" onclick="scanEffect();loadNewModel();">修复后</button>
`;
}
}

</script>
</body>
</html>
